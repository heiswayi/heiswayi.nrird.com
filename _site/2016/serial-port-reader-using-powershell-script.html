<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" class="no-js" itemscope itemtype="http://schema.org/WebPage"><link href="http://gmpg.org/xfn/11" rel="profile"><meta charset="UTF-8"><meta name="apple-mobile-web-app-capable" content="yes"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"><title> Serial port reader using PowerShell script · heiswayi nrird •••</title><meta name="description" content=" Initial release of lightweight Serial Port reader written using PowerShell script to read data from a serial port and also export the data into a log file. "/><meta name="keywords" content="powershell script, serial port, serial communication, ps1"><meta name="author" content="Heiswayi Nrird"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta property="og:type" content="article"><meta property="article:author" content="Heiswayi Nrird"><meta property="article:section" content=""><meta property="article:tag" content="powershell script, serial port, serial communication, ps1"><meta property="article:published_time" content="2016-12-21 00:00:00 +0800"><meta property="og:url" content="https://heiswayi.nrird.com/2016/serial-port-reader-using-powershell-script"><meta property="og:title" content=" Serial port reader using PowerShell script · heiswayi nrird ••• "><meta property="og:image" content="https://heiswayi.nrird.com/assets/logo.png"><meta property="og:description" content=" Initial release of lightweight Serial Port reader written using PowerShell script to read data from a serial port and also export the data into a log file. "><meta property="og:site_name" content="Heiswayi Nrird"><meta property="og:locale" content="en_US"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@heiswayi"><meta name="twitter:title" content=" Serial port reader using PowerShell script · heiswayi nrird ••• "><meta name="twitter:description" content=" Initial release of lightweight Serial Port reader written using PowerShell script to read data from a serial port and also export the data into a log file. "><meta name="twitter:image:src" content="https://heiswayi.nrird.com/assets/logo.png"><meta itemprop="name" content=" Serial port reader using PowerShell script · heiswayi nrird ••• "><meta itemprop="description" content=" Initial release of lightweight Serial Port reader written using PowerShell script to read data from a serial port and also export the data into a log file. "><meta itemprop="image" content="https://heiswayi.nrird.com/assets/logo.png"><link rel="canonical" href="https://heiswayi.nrird.com/2016/serial-port-reader-using-powershell-script"><link rel="alternate" type="application/rss+xml" title="RSS" href="https://heiswayi.nrird.com/feed.xml"><link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo="><link rel="stylesheet" href="https://heiswayi.nrird.com/assets/css/main.css?20180603"> <script src="https://heiswayi.nrird.com/assets/js/modernizr.custom.js"></script> <!--[if lt IE 9]> <script src="http://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script> <script src="http://cdnjs.cloudflare.com/ajax/libs/respond.js/1.1.0/respond.min.js"></script> <script src="https://heiswayi.nrird.com/assets/js/rem.min.js"></script> <![endif]--> <a href="#content" class="skip">Skip to content</a><div class="wrap"><div class="masthead"> <canvas id="canvas" style="width:100%;height:100%;max-height:230px;position:absolute;z-index:1;opacity:0.5"></canvas><div class="container"><h2 class="masthead-title"> <a href="https://heiswayi.nrird.com" title="heiswayi nrird •••" class="title">heiswayi nrird <span class="dot-red">•</span><span class="dot-yellow">•</span><span class="dot-green">•</span></a> <small>Between coding and random stuffs </small></h2><div class="footer-social-links"> <a href="http://heiswayi.github.io/feed.xml" title="RSS Feed" target="_blank"><i class="fa fa-rss"></i></a> <a href="https://my.linkedin.com/in/nrird" title="LinkedIn" target="_blank"><i class="fa fa-linkedin"></i></a> <!--<a href="https://www.facebook.com/heiswayi.nrird" title="Facebook" target="_blank"><i class="fa fa-facebook"></i></a>--> <!--<a href="https://twitter.com/HeiswayiNrird" title="Twitter" target="_blank"><i class="fa fa-twitter"></i></a>--> <a href="http://heiswayi.github.io/my-repos/" title="GitHub Repositories" target="_blank"><i class="fa fa-github-alt"></i></a> <a href="http://heiswayi.github.io/my-gists/" title="GitHub Gists" target="_blank"><i class="fa fa-code"></i></a> <a href="http://codepen.io/heiswayi/" title="CodePen" target="_blank"><i class="fa fa-codepen"></i></a> <a href="https://instagram.com/heiswayi.nrird/" title="Instagram" target="_blank"><i class="fa fa-instagram"></i></a> <a href="http://jsfiddle.net/user/heiswayi/" title="JSFiddle" target="_blank"><i class="fa fa-jsfiddle"></i></a></div><div class="nav"><ul class="top-menu"><li><a href="https://heiswayi.nrird.com/" title="Home"><i class="fa fa-home"></i></a><li><a href="https://heiswayi.nrird.com/about">About</a> <!--<li><a href="/resume">Resume <i class="fa fa-external-link-square"></i></a>--><li><a href="https://heiswayi.nrird.com/projects" class="bg-red"><i class="fa fa-space-shuttle" aria-hidden="true"></i> Projects</a><li><a href="https://heiswayi.nrird.com/tagged">Tags</a><li><a href="https://heiswayi.github.io/photography">Photography <i class="fa fa-external-link-square"></i></a><li><a href="https://heiswayi.nrird.com/reminder">Reminder</a></ul></div></div></div><div id="content" class="container content"><div class="post"><div class="post-top-meta"> <!--<div class="edit-this-page"><a href="https://github.com/heiswayi/heiswayi.github.io/blob/master/_posts/2016/2016-12-21-serial-port-reader-using-powershell-script.md">Edit this page</a></div>--><div class="post-date">December 21, 2016</div><h1 class="post-title">Serial port reader using PowerShell script</h1></div><p>I have made a complete PowerShell script to read data from a serial port and export the data into a log file. Sometimes, when I work with Arduino project, I just use this script to quickly connect to the Arduino board and check the data output.<p>Also available on my <a href="https://git.io/vpfrC">Gist</a> in case you want to contribute or help to improve this script.<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">&lt;#
.SYNOPSIS
   Listens to and read data from a serial port (e.g. COM port)
.DESCRIPTION
   The purpose of this script is to keep listening and read data from a serial port.
   All the data captured will be displayed and log into a file.
.EXAMPLE
   ./SerialPortReader.ps1
.EXAMPLE
   ./SerialPortReader.ps1 -PortName COM3 -BaudRate 9600
.EXAMPLE
   ./SerialPortReader.ps1 -PortName COM3 -BaudRate 9600 -Parity None -DataBits 8 -StopBits One -Handshake None -OutputFile ".\output1.log" -ReadInterval 1000
.LINK
   http://heiswayi.github.io
.AUTHOR
   Heiswayi Nrird, 2016
.LICENSE
   MIT
#&gt;</span>
<span class="o">[</span><span class="na">CmdletBinding</span><span class="o">(</span><span class="na">SupportsShouldProcess</span><span class="o">=</span><span class="nv">$true</span>, <span class="na">ConfirmImpact</span><span class="o">=</span><span class="s1">'Medium'</span><span class="o">)]</span>
<span class="o">[</span>Alias<span class="o">()]</span>
<span class="o">[</span>OutputType<span class="o">([</span><span class="kt">int</span><span class="o">])]</span>
<span class="k">Param</span>
<span class="o">(</span>
    <span class="o">[</span>Parameter<span class="o">(</span><span class="nv">Mandatory</span><span class="o">=</span><span class="nv">$true</span>, <span class="nv">Position</span><span class="o">=</span>0<span class="o">)]</span>
    <span class="o">[</span>ValidateNotNullOrEmpty<span class="o">()]</span>
    <span class="o">[</span><span class="kt">string</span><span class="o">]</span><span class="nv">$PortName</span> <span class="o">=</span> <span class="s2">"COM1"</span>,

    <span class="o">[</span>Parameter<span class="o">(</span><span class="nv">Mandatory</span><span class="o">=</span><span class="nv">$true</span>, <span class="nv">Position</span><span class="o">=</span>1<span class="o">)]</span>
    <span class="o">[</span>ValidateNotNullOrEmpty<span class="o">()]</span>
    <span class="o">[</span><span class="kt">int</span><span class="o">]</span><span class="nv">$BaudRate</span> <span class="o">=</span> 9600,

    <span class="o">[</span>Parameter<span class="o">(</span><span class="nv">Mandatory</span><span class="o">=</span><span class="nv">$false</span>, <span class="nv">Position</span><span class="o">=</span>2<span class="o">)]</span>
    <span class="o">[</span>ValidateNotNullOrEmpty<span class="o">()]</span>
    <span class="o">[</span>System.IO.Ports.Parity]<span class="nv">$Parity</span> <span class="o">=</span> <span class="o">[</span>System.IO.Ports.Parity]<span class="s2">"None"</span>,

    <span class="o">[</span>Parameter<span class="o">(</span><span class="nv">Mandatory</span><span class="o">=</span><span class="nv">$false</span>, <span class="nv">Position</span><span class="o">=</span>3<span class="o">)]</span>
    <span class="o">[</span>ValidateNotNullOrEmpty<span class="o">()]</span>
    <span class="o">[</span><span class="kt">int</span><span class="o">]</span><span class="nv">$DataBits</span> <span class="o">=</span> 8,

    <span class="o">[</span>Parameter<span class="o">(</span><span class="nv">Mandatory</span><span class="o">=</span><span class="nv">$false</span>, <span class="nv">Position</span><span class="o">=</span>4<span class="o">)]</span>
    <span class="o">[</span>ValidateNotNullOrEmpty<span class="o">()]</span>
    <span class="o">[</span>System.IO.Ports.StopBits]<span class="nv">$StopBits</span> <span class="o">=</span> <span class="o">[</span>System.IO.Ports.StopBits]<span class="s2">"One"</span>,

    <span class="o">[</span>Parameter<span class="o">(</span><span class="nv">Mandatory</span><span class="o">=</span><span class="nv">$false</span>, <span class="nv">Position</span><span class="o">=</span>5<span class="o">)]</span>
    <span class="o">[</span>ValidateNotNullOrEmpty<span class="o">()]</span>
    <span class="o">[</span>System.IO.Ports.Handshake]<span class="nv">$Handshake</span> <span class="o">=</span> <span class="o">[</span>System.IO.Ports.Handshake]<span class="s2">"None"</span>,

    <span class="o">[</span>Parameter<span class="o">(</span><span class="nv">Mandatory</span><span class="o">=</span><span class="nv">$false</span>, <span class="nv">Position</span><span class="o">=</span>6<span class="o">)]</span>
    <span class="o">[</span>ValidateNotNullOrEmpty<span class="o">()]</span>
	  <span class="o">[</span><span class="kt">string</span><span class="o">]</span><span class="nv">$OutputFile</span> <span class="o">=</span> <span class="s2">"notempty"</span>,

    <span class="o">[</span>Parameter<span class="o">(</span><span class="nv">Mandatory</span><span class="o">=</span><span class="nv">$false</span>, <span class="nv">Position</span><span class="o">=</span>7<span class="o">)]</span>
    <span class="o">[</span>ValidateNotNullOrEmpty<span class="o">()]</span>
	  <span class="o">[</span><span class="kt">int</span><span class="o">]</span><span class="nv">$ReadInterval</span> <span class="o">=</span> 1000
<span class="o">)</span>

<span class="cm">&lt;#
.SYNOPSIS
   Listens to and read data from a serial port (e.g. COM port)
.DESCRIPTION
   The purpose of this script is to keep listening and read data from a serial port.
   All the data captured will be displayed and log into a file.
.EXAMPLE
   SerialPortReader
.EXAMPLE
   SerialPortReader -PortName COM3 -BaudRate 9600
.EXAMPLE
   SerialPortReader -PortName COM3 -BaudRate 9600 -Parity None -DataBits 8 -StopBits One -Handshake None -OutputFile ".\output1.log" -ReadInterval 1000
.LINK
   http://heiswayi.github.io
.AUTHOR
   Heiswayi Nrird, 2016
.LICENSE
   MIT
#&gt;</span>
<span class="k">function </span>SerialPortReader
<span class="o">{</span>
    <span class="o">[</span><span class="na">CmdletBinding</span><span class="o">(</span><span class="na">SupportsShouldProcess</span><span class="o">=</span><span class="nv">$true</span>, <span class="na">ConfirmImpact</span><span class="o">=</span><span class="s1">'Medium'</span><span class="o">)]</span>
    <span class="o">[</span>Alias<span class="o">()]</span>
    <span class="o">[</span>OutputType<span class="o">([</span><span class="kt">int</span><span class="o">])]</span>
    <span class="k">Param</span>
    <span class="o">(</span>
        <span class="o">[</span>Parameter<span class="o">(</span><span class="nv">Mandatory</span><span class="o">=</span><span class="nv">$true</span>, <span class="nv">Position</span><span class="o">=</span>0<span class="o">)]</span>
        <span class="o">[</span>ValidateNotNullOrEmpty<span class="o">()]</span>
        <span class="o">[</span><span class="kt">string</span><span class="o">]</span><span class="nv">$PortName</span> <span class="o">=</span> <span class="s2">"COM1"</span>,

        <span class="o">[</span>Parameter<span class="o">(</span><span class="nv">Mandatory</span><span class="o">=</span><span class="nv">$true</span>, <span class="nv">Position</span><span class="o">=</span>1<span class="o">)]</span>
        <span class="o">[</span>ValidateNotNullOrEmpty<span class="o">()]</span>
        <span class="o">[</span><span class="kt">int</span><span class="o">]</span><span class="nv">$BaudRate</span> <span class="o">=</span> 9600,

        <span class="o">[</span>Parameter<span class="o">(</span><span class="nv">Mandatory</span><span class="o">=</span><span class="nv">$false</span>, <span class="nv">Position</span><span class="o">=</span>2<span class="o">)]</span>
        <span class="o">[</span>ValidateNotNullOrEmpty<span class="o">()]</span>
        <span class="o">[</span>System.IO.Ports.Parity]<span class="nv">$Parity</span> <span class="o">=</span> <span class="o">[</span>System.IO.Ports.Parity]<span class="s2">"None"</span>,

        <span class="o">[</span>Parameter<span class="o">(</span><span class="nv">Mandatory</span><span class="o">=</span><span class="nv">$false</span>, <span class="nv">Position</span><span class="o">=</span>3<span class="o">)]</span>
        <span class="o">[</span>ValidateNotNullOrEmpty<span class="o">()]</span>
        <span class="o">[</span><span class="kt">int</span><span class="o">]</span><span class="nv">$DataBits</span> <span class="o">=</span> 8,

        <span class="o">[</span>Parameter<span class="o">(</span><span class="nv">Mandatory</span><span class="o">=</span><span class="nv">$false</span>, <span class="nv">Position</span><span class="o">=</span>4<span class="o">)]</span>
        <span class="o">[</span>ValidateNotNullOrEmpty<span class="o">()]</span>
        <span class="o">[</span>System.IO.Ports.StopBits]<span class="nv">$StopBits</span> <span class="o">=</span> <span class="o">[</span>System.IO.Ports.StopBits]<span class="s2">"One"</span>,

        <span class="o">[</span>Parameter<span class="o">(</span><span class="nv">Mandatory</span><span class="o">=</span><span class="nv">$false</span>, <span class="nv">Position</span><span class="o">=</span>5<span class="o">)]</span>
        <span class="o">[</span>ValidateNotNullOrEmpty<span class="o">()]</span>
        <span class="o">[</span>System.IO.Ports.Handshake]<span class="nv">$Handshake</span> <span class="o">=</span> <span class="o">[</span>System.IO.Ports.Handshake]<span class="s2">"None"</span>,

        <span class="o">[</span>Parameter<span class="o">(</span><span class="nv">Mandatory</span><span class="o">=</span><span class="nv">$false</span>, <span class="nv">Position</span><span class="o">=</span>6<span class="o">)]</span>
        <span class="o">[</span>ValidateNotNullOrEmpty<span class="o">()]</span>
	      <span class="o">[</span><span class="kt">string</span><span class="o">]</span><span class="nv">$OutputFile</span> <span class="o">=</span> <span class="s2">"notempty"</span>,

        <span class="o">[</span>Parameter<span class="o">(</span><span class="nv">Mandatory</span><span class="o">=</span><span class="nv">$false</span>, <span class="nv">Position</span><span class="o">=</span>7<span class="o">)]</span>
        <span class="o">[</span>ValidateNotNullOrEmpty<span class="o">()]</span>
	      <span class="o">[</span><span class="kt">int</span><span class="o">]</span><span class="nv">$ReadInterval</span> <span class="o">=</span> 1000
    <span class="o">)</span>

    <span class="nv">$proceed</span> <span class="o">=</span> <span class="nv">$false</span>
    <span class="nb">Write-Output</span> <span class="o">(</span><span class="s2">"Checking PortName..."</span><span class="o">)</span>

    <span class="k">foreach</span> <span class="o">(</span><span class="nv">$item</span> <span class="k">in</span> <span class="o">[</span>System.IO.Ports.SerialPort]::GetPortNames<span class="o">())</span>
    <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="nv">$item</span> -eq <span class="nv">$PortName</span><span class="o">)</span>
        <span class="o">{</span>
            <span class="nv">$proceed</span> <span class="o">=</span> <span class="nv">$true</span>
            <span class="nb">Write-Output</span> <span class="o">(</span><span class="s2">"--&gt; PortName "</span> + <span class="nv">$PortName</span> + <span class="s2">" is available"</span><span class="o">)</span>
            <span class="k">break</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="nv">$proceed</span> -eq <span class="nv">$false</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="nb">Write-Warning</span> <span class="o">(</span><span class="s2">"--&gt; PortName "</span> + <span class="nv">$PortName</span> + <span class="s2">" not found"</span><span class="o">)</span>
        <span class="k">return</span>
    <span class="o">}</span>

    <span class="nv">$filename</span> <span class="o">=</span> <span class="s2">""</span>

    <span class="k">try</span>
    <span class="o">{</span>
        <span class="nv">$port</span> <span class="o">=</span> <span class="nb">New-Object </span>System.IO.Ports.SerialPort
        <span class="nv">$port</span>.PortName <span class="o">=</span> <span class="nv">$PortName</span>
        <span class="nv">$port</span>.BaudRate <span class="o">=</span> <span class="nv">$BaudRate</span>
        <span class="nv">$port</span>.Parity <span class="o">=</span> <span class="nv">$Parity</span>
        <span class="nv">$port</span>.DataBits <span class="o">=</span> <span class="nv">$DataBits</span>
        <span class="nv">$port</span>.StopBits <span class="o">=</span> <span class="nv">$StopBits</span>
        <span class="nv">$port</span>.Handshake <span class="o">=</span> <span class="nv">$Handshake</span>

        <span class="nv">$currentDate</span> <span class="o">=</span> <span class="nb">Get-Date</span> -Format yyyyMMdd
        <span class="nv">$fileExt</span> <span class="o">=</span> <span class="s2">".log"</span>
        <span class="k">if</span> <span class="o">(</span><span class="nv">$OutputFile</span> -eq <span class="s2">"notempty"</span><span class="o">)</span>
        <span class="o">{</span>
            <span class="nv">$filename</span> <span class="o">=</span> <span class="o">(</span><span class="nb">Get-Item</span> -Path <span class="s2">".\"</span> -Verbose<span class="o">)</span>.FullName + <span class="s2">"\SerialPortReader_"</span> + <span class="nv">$currentDate</span> + <span class="nv">$fileExt</span>
        <span class="o">}</span>
        <span class="k">else</span>
        <span class="o">{</span>
            <span class="nv">$filename</span> <span class="o">=</span> <span class="nv">$OutputFile</span>
        <span class="o">}</span>

        <span class="nb">Write-Output</span> <span class="o">(</span><span class="s2">"Establishing connection to the port..."</span><span class="o">)</span>
        <span class="nb">Start-Sleep</span> -Milliseconds 1000
        <span class="nv">$port</span>.Open<span class="o">()</span>
        <span class="nb">Write-Output</span> <span class="nv">$port</span>
        <span class="nb">Write-Output</span> <span class="o">(</span><span class="s2">"--&gt; Connection established."</span><span class="o">)</span>
        <span class="nb">Write-Output</span> <span class="o">(</span><span class="s2">""</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="k">catch</span> <span class="o">[</span>System.Exception]
    <span class="o">{</span>
        <span class="nb">Write-Error</span> <span class="o">(</span><span class="s2">"Failed to connect : "</span> + <span class="nv">$_</span><span class="o">)</span>
        <span class="nv">$error</span><span class="o">[</span>0] | <span class="nb">Format-List</span> -Force
        <span class="k">if</span> <span class="o">(</span><span class="nv">$port</span> -ne <span class="nv">$null</span><span class="o">)</span> <span class="o">{</span> <span class="nv">$port</span>.Close<span class="o">()</span> <span class="o">}</span>
        <span class="k">exit </span>1
    <span class="o">}</span>

    <span class="nb">Start-Sleep</span> -Milliseconds 1000

    <span class="k">do</span>
    <span class="o">{</span>
        <span class="nv">$key</span> <span class="o">=</span> <span class="k">if</span> <span class="o">(</span><span class="nv">$host</span>.UI.RawUI.KeyAvailable<span class="o">)</span> <span class="o">{</span> <span class="nv">$host</span>.UI.RawUI.ReadKey<span class="o">(</span><span class="s1">'NoEcho, IncludeKeyDown'</span><span class="o">)</span> <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="nv">$port</span>.IsOpen<span class="o">)</span>
        <span class="o">{</span>
            <span class="nb">Start-Sleep</span> -Milliseconds <span class="nv">$ReadInterval</span>

            <span class="c1">#$data = $port.ReadLine()</span>
            <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$port</span>.ReadExisting<span class="o">()</span>

            <span class="cm">&lt;#
            [byte[]]$readBuffer = New-Object byte[] ($port.ReadBufferSize + 1)
            try
            {
                [int]$count = $port.Read($readBuffer, 0, $port.ReadBufferSize)
                [string]$data = [System.Text.Encoding]::ASCII.GetString($readBuffer, 0, $count)
            }
            catch { }
            #&gt;</span>

            <span class="nv">$length</span> <span class="o">=</span> <span class="nv">$data</span>.Length

            <span class="c1"># remove newline chars</span>
            <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$data</span> -replace <span class="o">[</span>System.Environment]::NewLine,<span class="s2">""</span>

            <span class="nv">$getTimestamp</span> <span class="o">=</span> <span class="nb">Get-Date</span> -Format yyyy-MM-dd HH:mm:ss.fff
            <span class="nb">Write-Output</span> <span class="o">(</span><span class="s2">"["</span> + <span class="nv">$getTimestamp</span> + <span class="s2">"] "</span> + <span class="nv">$data</span><span class="o">)</span>
            <span class="k">if</span> <span class="o">(</span><span class="nv">$length</span> -gt 0<span class="o">)</span> <span class="o">{</span> ExportToFile -Filename <span class="nv">$filename</span> -Timestamp <span class="nv">$getTimestamp</span> -Data <span class="nv">$data</span> <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span> <span class="k">until</span> <span class="o">(</span><span class="nv">$key</span>.VirtualKeyCode -eq 81<span class="o">)</span> <span class="c1"># until 'q' is pressed</span>

    <span class="k">if</span> <span class="o">(</span><span class="nv">$port</span> -ne <span class="nv">$null</span><span class="o">)</span> <span class="o">{</span> <span class="nv">$port</span>.Close<span class="o">()</span> <span class="o">}</span>
<span class="o">}</span>

<span class="cm">&lt;#
.SYNOPSIS
   Listens to and read data from a serial port (e.g. COM port)
.DESCRIPTION
   The purpose of this script is to keep listening and read data from a serial port.
   All the data captured will be displayed and log into a file.
.EXAMPLE
   ExportToFile -Filename &lt;fullpath&gt; -Timestamp &lt;time string&gt; -Data &lt;data string&gt;
.AUTHOR
   Heiswayi Nrird, 2016
.LICENSE
   MIT
#&gt;</span>
<span class="k">function </span>ExportToFile
<span class="o">{</span>
    <span class="o">[</span><span class="na">CmdletBinding</span><span class="o">(</span><span class="na">SupportsShouldProcess</span><span class="o">=</span><span class="nv">$true</span>, <span class="na">ConfirmImpact</span><span class="o">=</span><span class="s1">'Medium'</span><span class="o">)]</span>
    <span class="o">[</span>OutputType<span class="o">([</span><span class="kt">string</span><span class="o">])]</span>
    <span class="k">Param</span>
    <span class="o">(</span>
        <span class="o">[</span>Parameter<span class="o">(</span><span class="nv">Mandatory</span><span class="o">=</span><span class="nv">$true</span>, <span class="nv">Position</span><span class="o">=</span>0<span class="o">)]</span>
	      <span class="o">[</span><span class="kt">string</span><span class="o">]</span><span class="nv">$Filename</span>,

        <span class="o">[</span>Parameter<span class="o">(</span><span class="nv">Mandatory</span><span class="o">=</span><span class="nv">$true</span>, <span class="nv">Position</span><span class="o">=</span>1<span class="o">)]</span>
        <span class="o">[</span><span class="kt">string</span><span class="o">]</span><span class="nv">$Timestamp</span>,

        <span class="o">[</span>Parameter<span class="o">(</span><span class="nv">Mandatory</span><span class="o">=</span><span class="nv">$true</span>, <span class="nv">Position</span><span class="o">=</span>2<span class="o">)]</span>
        <span class="o">[</span><span class="kt">string</span><span class="o">]</span><span class="nv">$Data</span>
    <span class="o">)</span>

    <span class="k">try</span>
    <span class="o">{</span>
        <span class="s2">"["</span> + <span class="nv">$Timestamp</span> + <span class="s2">"] "</span> + <span class="nv">$Data</span> | <span class="nb">Out-File</span> -FilePath <span class="nv">$Filename</span> -Encoding ascii -Append
    <span class="o">}</span>
    <span class="k">catch</span> <span class="o">[</span>System.Exception]
    <span class="o">{</span>
        <span class="nb">Write-Warning</span> <span class="o">(</span><span class="s2">"Failed to export captured data : "</span> + <span class="nv">$_</span><span class="o">)</span>
        <span class="k">return</span>
    <span class="o">}</span>
<span class="o">}</span>


<span class="k">if</span> <span class="o">(</span>-not <span class="o">(</span><span class="nv">$myinvocation</span>.line.Contains<span class="o">(</span><span class="s2">"</span><span class="se">`$</span><span class="s2">here\</span><span class="se">`$</span><span class="s2">sut"</span><span class="o">)))</span> <span class="o">{</span>
    SerialPortReader -PortName <span class="nv">$PortName</span> -BaudRate <span class="nv">$BaudRate</span> -Parity <span class="nv">$Parity</span> -DataBits <span class="nv">$DataBits</span> -StopBits <span class="nv">$StopBits</span> -Handshake <span class="nv">$Handshake</span> -OutputFile <span class="nv">$OutputFile</span> -ReadInterval <span class="nv">$ReadInterval</span>
<span class="o">}</span>
</code></pre></div></div><div class="tagged"> <a href="https://heiswayi.nrird.com/tagged#powershell"><i class="fa fa-hashtag muted" aria-hidden="true"></i>PowerShell</a> <a href="https://heiswayi.nrird.com/tagged#serialport"><i class="fa fa-hashtag muted" aria-hidden="true"></i>SerialPort</a></div><div id="disqus" style="margin-top:2em"><div id="disqus_thread"></div><script> var disqus_config = function() { this.page.url = "https://heiswayi.nrird.com/2016/serial-port-reader-using-powershell-script"; this.page.identifier = "/2016/serial-port-reader-using-powershell-script"; }; (function() { var d = document, s = d.createElement('script'); s.src = '//hnbloggithub.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></div></div><div class="footer"><div class="copyright"><i class="fa fa-copyright"></i> 2015 - 2018 Heiswayi Nrird // <a href="https://heiswayi.nrird.com/cookie-policy">Cookie Policy</a> // <a href="https://heiswayi.github.io/feed.xml">RSS</a></div></div><script> // Line numbering for code block (function() { var pre = document.getElementsByTagName('pre'), pl = pre.length; for (var i = 0; i < pl; i++) { pre[i].innerHTML = '<span class="line-number"></span>' + pre[i].innerHTML + '<span class="cl"></span>'; var num = pre[i].innerHTML.split(/\n/).length; for (var j = 0; j < (num - 1); j++) { var line_num = pre[i].getElementsByTagName('span')[0]; line_num.innerHTML += '<span>' + (j + 1) + '</span>'; } } })(); </script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-58296043-7', 'auto'); ga('send', 'pageview'); </script>
