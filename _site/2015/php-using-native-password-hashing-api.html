<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" class="no-js" itemscope itemtype="http://schema.org/WebPage"><link href="http://gmpg.org/xfn/11" rel="profile"><meta charset="UTF-8"><meta name="apple-mobile-web-app-capable" content="yes"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"><title> PHP - Using native password hashing API · heiswayi nrird •••</title><meta name="description" content=" Starting PHP version 5.5 onwards, password hashing in PHP application made easy as new native password hashing functions have been introduced. "/><meta name="keywords" content="php 5.5, password hashing, native api, php functions"><meta name="author" content="Heiswayi Nrird"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta property="og:type" content="article"><meta property="article:author" content="Heiswayi Nrird"><meta property="article:section" content=""><meta property="article:tag" content="php 5.5, password hashing, native api, php functions"><meta property="article:published_time" content="2015-10-01 00:00:00 +0800"><meta property="og:url" content="https://heiswayi.nrird.com/2015/php-using-native-password-hashing-api"><meta property="og:title" content=" PHP - Using native password hashing API · heiswayi nrird ••• "><meta property="og:image" content="https://heiswayi.nrird.com/assets/logo.png"><meta property="og:description" content=" Starting PHP version 5.5 onwards, password hashing in PHP application made easy as new native password hashing functions have been introduced. "><meta property="og:site_name" content="Heiswayi Nrird"><meta property="og:locale" content="en_US"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@heiswayi"><meta name="twitter:title" content=" PHP - Using native password hashing API · heiswayi nrird ••• "><meta name="twitter:description" content=" Starting PHP version 5.5 onwards, password hashing in PHP application made easy as new native password hashing functions have been introduced. "><meta name="twitter:image:src" content="https://heiswayi.nrird.com/assets/logo.png"><meta itemprop="name" content=" PHP - Using native password hashing API · heiswayi nrird ••• "><meta itemprop="description" content=" Starting PHP version 5.5 onwards, password hashing in PHP application made easy as new native password hashing functions have been introduced. "><meta itemprop="image" content="https://heiswayi.nrird.com/assets/logo.png"><link rel="canonical" href="https://heiswayi.nrird.com/2015/php-using-native-password-hashing-api"><link rel="alternate" type="application/rss+xml" title="RSS" href="https://heiswayi.nrird.com/feed.xml"><link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo="><link rel="stylesheet" href="https://heiswayi.nrird.com/assets/css/main.css?20180603"> <script src="https://heiswayi.nrird.com/assets/js/modernizr.custom.js"></script> <!--[if lt IE 9]> <script src="http://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script> <script src="http://cdnjs.cloudflare.com/ajax/libs/respond.js/1.1.0/respond.min.js"></script> <script src="https://heiswayi.nrird.com/assets/js/rem.min.js"></script> <![endif]--> <a href="#content" class="skip">Skip to content</a><div class="wrap"><div class="masthead"> <canvas id="canvas" style="width:100%;height:100%;max-height:230px;position:absolute;z-index:1;opacity:0.5"></canvas><div class="container"><h2 class="masthead-title"> <a href="https://heiswayi.nrird.com" title="heiswayi nrird •••" class="title">heiswayi nrird <span class="dot-red">•</span><span class="dot-yellow">•</span><span class="dot-green">•</span></a> <small>Between coding and random stuffs </small></h2><div class="footer-social-links"> <a href="http://heiswayi.github.io/feed.xml" title="RSS Feed" target="_blank"><i class="fa fa-rss"></i></a> <a href="https://my.linkedin.com/in/nrird" title="LinkedIn" target="_blank"><i class="fa fa-linkedin"></i></a> <!--<a href="https://www.facebook.com/heiswayi.nrird" title="Facebook" target="_blank"><i class="fa fa-facebook"></i></a>--> <!--<a href="https://twitter.com/HeiswayiNrird" title="Twitter" target="_blank"><i class="fa fa-twitter"></i></a>--> <a href="http://heiswayi.github.io/my-repos/" title="GitHub Repositories" target="_blank"><i class="fa fa-github-alt"></i></a> <a href="http://heiswayi.github.io/my-gists/" title="GitHub Gists" target="_blank"><i class="fa fa-code"></i></a> <a href="http://codepen.io/heiswayi/" title="CodePen" target="_blank"><i class="fa fa-codepen"></i></a> <a href="https://instagram.com/heiswayi.nrird/" title="Instagram" target="_blank"><i class="fa fa-instagram"></i></a> <a href="http://jsfiddle.net/user/heiswayi/" title="JSFiddle" target="_blank"><i class="fa fa-jsfiddle"></i></a></div><div class="nav"><ul class="top-menu"><li><a href="https://heiswayi.nrird.com/" title="Home"><i class="fa fa-home"></i></a><li><a href="https://heiswayi.nrird.com/about">About</a> <!--<li><a href="/resume">Resume <i class="fa fa-external-link-square"></i></a>--><li><a href="https://heiswayi.nrird.com/projects" class="bg-red"><i class="fa fa-space-shuttle" aria-hidden="true"></i> Projects</a><li><a href="https://heiswayi.nrird.com/tagged">Tags</a><li><a href="https://heiswayi.github.io/photography">Photography <i class="fa fa-external-link-square"></i></a><li><a href="https://heiswayi.nrird.com/reminder">Reminder</a></ul></div></div></div><div id="content" class="container content"><div class="post"><div class="post-top-meta"> <!--<div class="edit-this-page"><a href="https://github.com/heiswayi/heiswayi.github.io/blob/master/_posts/2015/2015-10-01-php-using-native-password-hashing-api.md">Edit this page</a></div>--><div class="post-date">October 01, 2015</div><h1 class="post-title">PHP - Using native password hashing API</h1></div><p><strong>Great news to PHP developers!</strong> As of PHP 5.5, a <a href="https://wiki.php.net/rfc/password_hash">native and simple password hashing API</a> was introduced to safely handle both hashing and verifying password in a secure manner. When talking about hashing the password, the two most important considerations are the computational expense and the salt. The more computationally expensive the hashing algorithm, the longer it will take to “bruteforce” its output. So, the suggested algorithm to use when hashing the password is Blowfish, which is also the default hashing algorithm used by this password hashing API. Please note that, these two weak hashing algorithms <code class="highlighter-rouge">md5()</code> and <code class="highlighter-rouge">sha1()</code> are no longer practical and acceptable to be used these days as they can be “bruteforced” in seconds.<h3 id="implementation-of-native-password-hashing-api">Implementation of native password hashing API</h3><p>The implementation consists of four functions:-<ul><li><code class="highlighter-rouge">password_hash()</code> : To create a new password hash<li><code class="highlighter-rouge">password_verify()</code> : To confirm a given password matches with the hash<li><code class="highlighter-rouge">password_needs_rehash()</code> : To check if a password meets the desired hash settings (algorithm, cost)<li><code class="highlighter-rouge">password_get_info()</code> : To return information about the hash such as algorithm and cost</ul><p><strong>NOTE:</strong> <code class="highlighter-rouge">password_hash()</code> creates a new password hash using a strong one-way hashing algorithm and compatible with <a href="http://php.net/manual/en/function.crypt.php"><strong>crypt()</strong></a>.<h3 id="usage-examples">Usage Examples</h3><h4 id="example-1">Example 1</h4><p><code class="highlighter-rouge">password_hash()</code> example with <strong>PASSWORD_DEFAULT</strong><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="sd">/**
 * We just want to hash our password using the current DEFAULT algorithm.
 * This is presently BCRYPT, and will produce a 60 character result.
 *
 * Beware that DEFAULT may change over time, so you would want to prepare
 * By allowing your storage to expand past 60 characters (255 would be good)
 */</span>
<span class="k">echo</span> <span class="nb">password_hash</span><span class="p">(</span><span class="s2">"KittenDies"</span><span class="p">,</span> <span class="nx">PASSWORD_DEFAULT</span><span class="p">)</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="cp">?&gt;</span>
</code></pre></div></div><p>Output:<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$2y$10$kZ8eWlGS30qABEthikt.uOvdYETzS3azGCutmfOdtXMzEvFuNoMWe
</code></pre></div></div><h4 id="example-2">Example 2</h4><p><code class="highlighter-rouge">password_hash()</code> example with setting <strong>cost</strong> manually<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="sd">/**
 * In this case, we want to increase the default cost for BCRYPT to 12.
 * Note that we also switched to BCRYPT, which will always be 60 characters.
 */</span>
<span class="nv">$options</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'cost'</span> <span class="o">=&gt;</span> <span class="mi">12</span><span class="p">,</span>
<span class="p">];</span>
<span class="k">echo</span> <span class="nb">password_hash</span><span class="p">(</span><span class="s2">"KittenDies"</span><span class="p">,</span> <span class="nx">PASSWORD_BCRYPT</span><span class="p">,</span> <span class="nv">$options</span><span class="p">)</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="cp">?&gt;</span>
</code></pre></div></div><p>Output:<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$2y$12$gsF2.s.PkKLusBMsgHrQnOmB5mzG0bHGE97.SA5250aQ0ZTt0Klty
</code></pre></div></div><p>The role of the cost is to ensure that the passwords remain difficult to bruteforce even as hardware gets faster. You will need to continuously tweak your cost as your own hardware changes. However, if you are not careful and just crank it up to 11 (figuratively speaking) your passwords will take too long to generate, tying up web server threads and can easily lead to a denial-of-service (DoS) attack.<p>Here’s the code to benchmark your server in order <strong>to determine how high of a cost you can afford</strong>:<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$timeTarget</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">;</span> <span class="c1">// 50 milliseconds
</span>
<span class="nv">$cost</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
<span class="k">do</span> <span class="p">{</span>
    <span class="nv">$cost</span><span class="o">++</span><span class="p">;</span>
    <span class="nv">$start</span> <span class="o">=</span> <span class="nb">microtime</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="nb">password_hash</span><span class="p">(</span><span class="s2">"test"</span><span class="p">,</span> <span class="nx">PASSWORD_BCRYPT</span><span class="p">,</span> <span class="p">[</span><span class="s2">"cost"</span> <span class="o">=&gt;</span> <span class="nv">$cost</span><span class="p">]);</span>
    <span class="nv">$end</span> <span class="o">=</span> <span class="nb">microtime</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="p">}</span> <span class="k">while</span> <span class="p">((</span><span class="nv">$end</span> <span class="o">-</span> <span class="nv">$start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nv">$timeTarget</span><span class="p">);</span>

<span class="k">echo</span> <span class="s2">"Appropriate Cost Found: "</span> <span class="o">.</span> <span class="nv">$cost</span> <span class="o">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="cp">?&gt;</span>
</code></pre></div></div><p>Output:<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Appropriate Cost Found: 10
</code></pre></div></div><p>This is good if you want to set the highest cost that you can without slowing down your server too much. <strong>8 - 10 is a good baseline</strong>, and is good if your servers are fast enough. The code above aims for less than 50ms stretching time, which is a good baseline for systems handling interactive logins.<h4 id="example-3">Example 3</h4><p><code class="highlighter-rouge">password_hash()</code> example with setting <strong>salt</strong> manually<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="sd">/**
 * Note that the salt here is randomly generated.
 * Never use a static salt or one that is not randomly generated.
 *
 * For the VAST majority of use-cases, let password_hash generate the salt randomly for you
 */</span>
<span class="nv">$options</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'cost'</span> <span class="o">=&gt;</span> <span class="mi">11</span><span class="p">,</span>
    <span class="s1">'salt'</span> <span class="o">=&gt;</span> <span class="nb">mcrypt_create_iv</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="nx">MCRYPT_DEV_URANDOM</span><span class="p">),</span>
<span class="p">];</span>
<span class="k">echo</span> <span class="nb">password_hash</span><span class="p">(</span><span class="s2">"KittenDies"</span><span class="p">,</span> <span class="nx">PASSWORD_BCRYPT</span><span class="p">,</span> <span class="nv">$options</span><span class="p">)</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="cp">?&gt;</span>
</code></pre></div></div><p>Output:<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$2y$11$dtSMAuO41g5QZcAG76FqTehpk35Dcf0lkEpBffEW7dRqQsrR2E8VO
</code></pre></div></div><blockquote><p><strong>Caution:</strong> It is strongly recommended that you do not generate your own salt for this function. It will create a secure salt automatically for you if you do not specify one.</blockquote><h4 id="example-4">Example 4</h4><p><code class="highlighter-rouge">password_verify()</code> example<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$hash</span> <span class="o">=</span> <span class="s1">'$2y$11$dtSMAuO41g5QZcAG76FqTehpk35Dcf0lkEpBffEW7dRqQsrR2E8VO'</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">password_verify</span><span class="p">(</span><span class="s1">'KittenDies'</span><span class="p">,</span> <span class="nv">$hash</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s1">'Password is valid!'</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s1">'Invalid password.'</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div></div><p>Output:<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Password is valid!
</code></pre></div></div><p>If you get incorrect false responses from <code class="highlighter-rouge">password_verify()</code> when manually including the hash variable (eg. for testing) and you know it should be correct, make sure you are enclosing the hash variable in single quotes (‘) and not double quotes (“).<h4 id="example-5">Example 5</h4><p><code class="highlighter-rouge">password_needs_rehash()</code> example<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$password</span> <span class="o">=</span> <span class="s1">'rasmuslerdorf'</span><span class="p">;</span>
<span class="nv">$hash</span> <span class="o">=</span> <span class="s1">'$2y$10$YCFsG6elYca568hBi2pZ0.3LDL5wjgxct1N8w/oLR/jfHsiQwCqTS'</span><span class="p">;</span>

<span class="c1">// The cost parameter can change over time as hardware improves
</span><span class="nv">$options</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'cost'</span> <span class="o">=&gt;</span> <span class="mi">11</span><span class="p">);</span>

<span class="c1">// Verify stored hash against plain-text password
</span><span class="k">if</span> <span class="p">(</span><span class="nb">password_verify</span><span class="p">(</span><span class="nv">$password</span><span class="p">,</span> <span class="nv">$hash</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Check if a newer hashing algorithm is available
</span>    <span class="c1">// or the cost has changed
</span>    <span class="k">if</span> <span class="p">(</span><span class="nb">password_needs_rehash</span><span class="p">(</span><span class="nv">$hash</span><span class="p">,</span> <span class="nx">PASSWORD_DEFAULT</span><span class="p">,</span> <span class="nv">$options</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// If so, create a new hash, and replace the old one
</span>        <span class="nv">$newHash</span> <span class="o">=</span> <span class="nb">password_hash</span><span class="p">(</span><span class="nv">$password</span><span class="p">,</span> <span class="nx">PASSWORD_DEFAULT</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Log user in
</span><span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div></div><h4 id="example-6">Example 6</h4><p><code class="highlighter-rouge">password_get_info()</code> example<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$hash</span> <span class="o">=</span> <span class="s1">'$2y$11$dtSMAuO41g5QZcAG76FqTehpk35Dcf0lkEpBffEW7dRqQsrR2E8VO'</span><span class="p">;</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nb">password_get_info</span><span class="p">(</span><span class="nv">$hash</span><span class="p">));</span>

<span class="cp">?&gt;</span>
</code></pre></div></div><p>Output:<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array (size=3)
  'algo' =&gt; int 1
  'algoName' =&gt; string 'bcrypt' (length=6)
  'options' =&gt;
    array (size=1)
      'cost' =&gt; int 11
</code></pre></div></div><h3 id="compatibility-issue">Compatibility issue</h3><p>If you are not using PHP 5.5 or below, there is a <a href="https://github.com/ircmaxell/password_compat">pure PHP compatibility library</a> available for PHP 5.3.7 and later.<h3 id="salt">Salt</h3><p>A cryptographic salt is a data which is applied during the hashing process in order to eliminate the possibility of the output being looked up in a list of pre-calculated pairs of hashes and their input, known as a rainbow table.<p><code class="highlighter-rouge">password_hash()</code> will create a random salt if one is not provided, and this is generally the easiest and the most secure approach.<h4 id="storing-the-salt">Storing the salt</h4><p>When using <code class="highlighter-rouge">password_hash()</code> or <code class="highlighter-rouge">crypt()</code>, the return value includes the salt as part of the generated hash. This value should be stored verbatim in your database, as it includes information about the hash function that was used and can then be given directly to <code class="highlighter-rouge">password_verify()</code> or <code class="highlighter-rouge">crypt()</code> when verifying passwords.<p><img src="http://i.imgur.com/9cmcBRo.png" alt="Password Hash" /><p>The diagram above shows the format of a return value from <code class="highlighter-rouge">crypt()</code> or <code class="highlighter-rouge">password_hash()</code>. As you can see, they are self-contained, with all the information on the algorithm and salt required for future password verification.<h3 id="conclusion">Conclusion</h3><p>With this new <a href="http://php.net/password">password extension</a> that comes as built-in functions, the password hashing becomes more easier as we don’t need to create our custom-made algorithm class or use any other external password hashing class library in our application anymore.<div class="tagged"> <a href="https://heiswayi.nrird.com/tagged#php"><i class="fa fa-hashtag muted" aria-hidden="true"></i>PHP</a> <a href="https://heiswayi.nrird.com/tagged#password-hashing"><i class="fa fa-hashtag muted" aria-hidden="true"></i>Password Hashing</a></div><div id="disqus" style="margin-top:2em"><div id="disqus_thread"></div><script> var disqus_config = function() { this.page.url = "https://heiswayi.nrird.com/2015/php-using-native-password-hashing-api"; this.page.identifier = "/2015/php-using-native-password-hashing-api"; }; (function() { var d = document, s = d.createElement('script'); s.src = '//hnbloggithub.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></div></div><div class="footer"><div class="copyright"><i class="fa fa-copyright"></i> 2015 - 2018 Heiswayi Nrird // <a href="https://heiswayi.nrird.com/cookie-policy">Cookie Policy</a> // <a href="https://heiswayi.github.io/feed.xml">RSS</a></div></div><script> // Line numbering for code block (function() { var pre = document.getElementsByTagName('pre'), pl = pre.length; for (var i = 0; i < pl; i++) { pre[i].innerHTML = '<span class="line-number"></span>' + pre[i].innerHTML + '<span class="cl"></span>'; var num = pre[i].innerHTML.split(/\n/).length; for (var j = 0; j < (num - 1); j++) { var line_num = pre[i].getElementsByTagName('span')[0]; line_num.innerHTML += '<span>' + (j + 1) + '</span>'; } } })(); </script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-58296043-7', 'auto'); ga('send', 'pageview'); </script>
